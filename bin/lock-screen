#! /bin/bash

unlock() {
	setxkbmap -rules /usr/share/X11/xkb/rules/evdev
	dunstctl set-paused false
	bspc wm -r
	bspc node -k
}

main() {
	clear

	tty-clock -r -D -B -s -S
	su $USER sh -c '' && unlock || main
}

trap "" 1 2 3 15 20 SIGTSTP

~/bin/permafocus $(bspc query -N -n) &

xkbcomp ~/.local/bspwm-setup/lockscreen.xkb $DISPLAY 2>/dev/null

killall -qw sxhkd polybar
dunstctl set-paused true

sleep 1

main
