#! /bin/bash

# real windows? (there is always a pidless phantom window)
if [ "$(xdo pid $(bspc query -N) | wc -l)" -gt 0 ]; then
	echo "Please close all windows first."
	exit 1
fi

MONITORS=$(xrandr --listmonitors | head -n 1 | awk '{print $2}')

ls ~/.config/bspwm/intro_${MONITORS}_monitors.canvas ~/.config/bspwm/intro_${MONITORS}_monitors.rules
if [ "$?" != "0" ]; then
	echo "Your number of monitors is not supported."
	exit 1
fi

bspc wm -l ~/.config/bspwm/intro_${MONITORS}_monitors.canvas
~/.config/bspwm/intro_${MONITORS}_monitors.rules

WINIT_X11_SCALE_FACTOR=1.0 alacritty -e musikbox -e -n -v 0.4 -p ~/.wmintro_audio &
sleep 0.25

WINIT_X11_SCALE_FACTOR=1.0 alacritty -e sh -c 'cava | lolcat' &
sleep 0.25

WINIT_X11_SCALE_FACTOR=1.0 alacritty -e neo-matrix -D &
sleep 0.25

PATH="${PATH}:${HOME}/bin" WINIT_X11_SCALE_FACTOR=1.0 alacritty -e slw &
sleep 0.25

WINIT_X11_SCALE_FACTOR=1.0 alacritty -e tty-clock -srDB &
sleep 0.25

while [ -n "$(pgrep -x musikbox)" ]; do sleep 1; done

bspc rule -r *
killall alacritty
bspc monitor -f 1
