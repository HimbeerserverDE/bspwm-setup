#! /usr/bin/env lua

-- Copyright (C) 2022  HimbeerserverDE
-- 
-- This program is free software: you can redistribute it and/or modify
-- it under the terms of the GNU General Public License as published by
-- the Free Software Foundation, either version 3 of the License, or
-- (at your option) any later version.
-- 
-- This program is distributed in the hope that it will be useful,
-- but WITHOUT ANY WARRANTY; without even the implied warranty of
-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-- GNU General Public License for more details.
-- 
-- You should have received a copy of the GNU General Public License
-- along with this program.  If not, see <https://www.gnu.org/licenses/>.

function string:ends_with(str)
	return self:sub(#self - #str + 1, #self) == str
end

local commands = {
	["batcat"] = {".c", ".cpp", ".h", ".hpp", ".lua", ".rb", ".java", ".xml", ".html", ".py", ".go", ".asm", ".php", ".rs", ".sh", ".diff", ".patch", ".js", ".css", "Makefile", ".basrc", ".bash_aliases", ".zshrc"},
	["~/.local/kitty.app/bin/kitty +kitten icat"] = {".png", ".jpg", ".jpeg", ".gif", ".svg"},
	["lolcat"] = {".txt"},
}

function get_command(file)
	for cmd, endings in pairs(commands) do
		for _, ending in pairs(endings) do
			if file:ends_with(ending) then
				return cmd
			end
		end
	end

	return "/bin/cat"
end

for _, file in ipairs(arg) do
	os.execute(get_command(file) .. " \"" .. file .. "\"", "r")
end
